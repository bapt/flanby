\input{../template/freebsd.tex}
\usepackage{CJKutf8}
\newcommand{\prestitle}{AsiaBSDCon 2015}

\title{FreeBSD: 5 years of pkg}
\subtitle{A end less journey}
\author{Baptiste Daroussin \\ \url{bapt@FreeBSD.org}}
\institute{\includegraphics[scale=0.5]{../template/logo.pdf}}
\date{AsiaBSDCon 2015 \\ Tokyo - \begin{CJK}{UTF8}{min}東京\end{CJK}\\ March 15st, 2015}

\begin{document}
\begin{frame}[plain]
	\titlepage
\end{frame}

\begin{frame}
	\frametitle{Once upon a time... the binary packages\\\begin{CJK}{UTF8}{min}昔々...バイナリパッケージ\end{CJK}}
	From the package point of view
	\begin{itemize}
		\item No binary upgrade
		\item Inconsistencies
		\item Lots of failing scripts
		\item No signing support
		\item No predictable updates
		\item Sacrifice of chicken mandatory
		\item DO NOT EVER TOUCH IT AGAIN WHEN YOU MANAGE TO INSTALL
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Once upon a time... the binary packages\\\begin{CJK}{UTF8}{min}昔々...バイナリパッケージ\end{CJK}}
	Other OS:
	\begin{itemize}
		\item NetBSD:
			\begin{itemize}
				\item pkg\_tools == pkg\_install++
				\item no library
				\item pkgin tight to pkg\_tools
			\end{itemize}
		\item OpenBSD:
			\begin{itemize}
				\item pkg\_add: full featured
				\item closely tight to OpenBSD's ports tree
				\item perl (not in base on FreeBSD)
			\end{itemize}
		\item Linux:
			\begin{itemize}
				\item apt/dpkg: full featured, GPLv2, no library
				\item yum/rpm: full featured, GPLv2, no library
				\item libsolv: very good solver, MIT, strict semantic not ports friendly
			\end{itemize}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Once upon a time... the ports tree\\\begin{CJK}{UTF8}{min}昔々... portsツリー\end{CJK}}
	What about the ports tree:
	\begin{itemize}
		\item fragile (no destdir/stagedir)
		\item work to some extent \\ (thanks portmaster/portupgrade)
		\item inconsistent and creative:
			\begin{itemize}
				\item script could be found in any language
				\item 20 ways to badly do one thing
				\item 8 sides wheels keeps being reinveted
			\end{itemize}
		\item Better than web archive
		\item Overlink all over the place (hi libtool)
		\item No unicity to identify packages
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Principles\\\begin{CJK}{UTF8}{min}原則\end{CJK}}
	\begin{itemize}
		\item Full featured library
		\item One command to rule them all
		\item Simple UI
		\item Only depend on base
		\item Ports friendly
		\item Fast enough with 25k packages
		\item BSD license
		\item Portable
		\item Extensible (ucl keywords)
		\item Binary centric
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{History\\\begin{CJK}{UTF8}{min}歴史\end{CJK}}
	\framesubtitle{FreeBSD}
	\begin{itemize}
		\item Sept. 2010: First commit
		\item March 2011: pkgng 0.1-alpha1
		\item January 2012: 1.0 beta1:\\ pkg enters in the ports tree
		\item August 2012: 1.0
		\item October 2012: default on -CURRENT
		\item June 2013: 1.1
		\item November 2013: 1.2
		\item January 2014: 10.0 on pkg
		\item July 2014: 1.3
		\item September 2014: pkg\_install EOL
		\item December 2014: 1.4
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{History\\\begin{CJK}{UTF8}{min}歴史\end{CJK}}
	\framesubtitle{DragonflyBSD}
	\begin{itemize}
		\item December 2012: Dports creation
		\item January 2013: Announcement
		\item April 2013: 3.4 \\ Support both pkg and pkgsrc
		\item November 2013: 3.6 \\ pkg only
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{History\\\begin{CJK}{UTF8}{min}歴史\end{CJK}}
	\framesubtitle{Others}
	\begin{itemize}
		\item 2014: Initial support for OS X
		\item 2014: Initial support for Linux
		\item 2015: Initial support for NetBSD/EdgeBSD
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Mistakes\\\begin{CJK}{UTF8}{min}間違い\end{CJK}}
	\begin{itemize}
		\item Started as a pet project
		\item Not enough strong directions
		\item Regression/Unit tests added very late
		\item Too much compromise accepted
		\item Lack of "project" communication
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Improvements\\\begin{CJK}{UTF8}{min}改善点\end{CJK}}
	\begin{itemize}
		\item Cleaning up/removing all the compatibility stuff
		\item More test driven developement
		\item Reduce the scope of what pkg(8) should do
		\item Focus on stabilising what we have
		\item Attract new developers
		\item Give more clear directions, ROADMAP
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Roadmap\\\begin{CJK}{UTF8}{min}ロードマップ\end{CJK}}
	\begin{itemize}
		\item Provides/Requires
		\item Flexible dependencies
		\item sub packages (ports related)
		\item flavours/alternatives (ports related)
		\item List of supported ABI
		\item Maybe extensibility: plugins? lua? duktape? jimtcl?
		\item Transactions
		\item More regression tests
		\item 3rd party repositories:
			\begin{itemize}
				\item ports tree
				\item yum (aka linux packages)
				\item CPAN
			\end{itemize}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{New in pkg 1.5\\\begin{CJK}{UTF8}{min}pkg 1.5 変更履歴\end{CJK}}
	\begin{itemize}
		\item Improved support for NetBSD/EdgeBSD
		\item Initial support for OSX
		\item Extended credential support in plist (support for flags)
		\item 40+ new regression tests
		\item Lots of bugfixes
		\item Custom keywords can have arguments in plist
		\item Initial support for provides/requires
		\item Public API now C++ friendly
		\item Support to package files with immutable flags as a user
		\item Initial support for cross installation
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Packaging base\\\begin{CJK}{UTF8}{min}-> パッケージ・ベース\end{CJK}}
	\framesubtitle{Users expectations}
	\begin{itemize}
		\item Keep base as a one true entity
		\item Fine grain package to reduce security updates
		\item Most options in separate packages
		\item Development tools in separate packages
		\item Debug packages
		\item Ability on only install runtime things (no .a, no .h etc)
		\item Ability for developers to provide a custom repository to allow users to test their changes. Example: a new libc++
		\item 3 way merge to handle /etc files
		\item Ability to create packages as root and user
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Packaging base\\\begin{CJK}{UTF8}{min}パッケージ・ベース\end{CJK}}
	\framesubtitle{What and when}
	\begin{itemize}
		\item Packages for RELEASES and security fixes
		\item Packages for STABLE branches
		\item Packages for HEAD
		\item Starting from FreeBSD 11.0-RELEASE
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Some links\\\begin{CJK}{UTF8}{min}いくつかのリンク\end{CJK}}
	\begin{itemize}
		\item pkg: \url{https://github.com/freebsd/pkg}
		\item issues: \url{https://github.com/freebsd/pkg/issues} \\
		\item introduction: \url{https://www.freebsd.org/doc/handbook/pkgng-intro.html}
		\item packaging base: \url{https://svnweb.freebsd.org/base/projects/release-pkg}
	\end{itemize}
\end{frame}

\begin{frame}[plain]
	\frametitle{Questions?\\\begin{CJK}{UTF8}{min}質問\end{CJK}}
	\begin{center}
		\Huge Thanks
		\\
		\Huge \begin{CJK}{UTF8}{min}ありがとう\\ございました\end{CJK}
	\end{center}
\end{frame}

\end{document}
